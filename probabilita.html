<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <title>Probabilit√† e scienza dei dati - Giacomo Dimarco - Dashboard Studio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f3f4f6;
      --card-bg: #ffffff;
      --accent: #2563eb;
      --accent-soft: #3b82f6;
      --accent-light: #e0f2ff;
      --text: #111827;
      --text-soft: #6b7280;
      --border-soft: #d1d5db;
      --danger: #dc2626;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    header {
      padding: 16px 24px;
      border-bottom: 1px solid var(--border-soft);
      background: #ffffff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    header h1 {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: 0.03em;
      color: var(--text);
    }

    header .subtitle {
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    .tag {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--accent-soft);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--accent);
      background: var(--accent-light);
    }

    main {
      padding: 16px 24px 32px;
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card {
      background: var(--card-bg);
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06);
      overflow: hidden;
    }

    .card-header {
      padding: 10px 16px;
      border-bottom: 1px solid var(--border-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      background: #f9fafb;
    }

    .card-header h2 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
    }

    .card-header span {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .card-body {
      padding: 12px 16px 16px;
    }

    /* Navigazione video */
    .video-controls-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 8px 0 8px;
      gap: 8px;
      flex-wrap: wrap;
    }

    .video-nav {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
      color: var(--text-soft);
      white-space: nowrap;
    }

    .nav-btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      padding: 2px 8px;
      cursor: pointer;
      font-size: 0.8rem;
      line-height: 1.4;
    }

    .nav-btn:hover {
      background: #eff6ff;
      border-color: #bfdbfe;
    }

    /* Video section */
    .video-player-wrapper {
      margin-bottom: 8px;
      background: #000000;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid var(--border-soft);
    }

    .video-iframe-container {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9 */
      background: #000000;
    }

    .video-iframe-container iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
      border-radius: 0;
    }

    .video-hint {
      font-size: 0.8rem;
      color: #e5e7eb;
      padding: 6px 10px;
      border-top: 1px solid #111827;
      background: #0f172a;
    }

    .video-hint strong {
      color: #ffffff;
    }

    .playlist {
      max-height: 320px;
      overflow-y: auto;
      padding-right: 4px;
      scrollbar-width: thin;
      scrollbar-color: var(--accent) #f3f4f6;
    }

    .playlist::-webkit-scrollbar {
      width: 6px;
    }
    .playlist::-webkit-scrollbar-thumb {
      background: var(--accent);
      border-radius: 999px;
    }
    .playlist::-webkit-scrollbar-track {
      background: #f3f4f6;
    }

    .playlist-item {
      width: 100%;
      border: none;
      background: transparent;
      display: flex;
      text-align: left;
      padding: 8px;
      margin-bottom: 4px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.12s ease, border 0.12s ease, transform 0.05s ease;
      border: 1px solid transparent;
      position: relative;
    }

    .playlist-item:hover {
      background: #eff6ff;
      border-color: #bfdbfe;
      transform: translateY(-1px);
    }

    .playlist-item.active {
      border-color: var(--accent-soft);
      background: #dbeafe;
    }

    .playlist-item.seen:not(.active) {
      background: #f3f4ff;
      border-color: #e0e7ff;
    }

    .playlist-thumbnail {
      width: 72px;
      height: 40px;
      border-radius: 6px;
      background: var(--accent-soft);
      margin-right: 10px;
      position: relative;
      flex-shrink: 0;
    }

    .playlist-thumbnail .play-icon {
      position: absolute;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.8rem;
      color: #ffffff;
    }

    .playlist-meta {
      flex: 1;
      min-width: 0;
    }

    .playlist-title {
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: var(--text);
    }

    .playlist-subtitle {
      font-size: 0.75rem;
      color: var(--text-soft);
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 1px 6px;
      border-radius: 999px;
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border: 1px solid;
    }

    .badge-lesson {
      border-color: #cbd5f5;
      color: #4b5563;
      background: #f9fafb;
    }

    .badge-tutorato {
      border-color: #2563eb;
      color: #1d4ed8;
      background: #eff6ff;
    }

    .badge-extra {
      border-color: #fb923c;
      color: #c05621;
      background: #ffedd5;
    }

    .playlist-item.tutorato .playlist-thumbnail {
      background: #60a5fa;
    }

    .seen-flag {
      font-size: 0.7rem;
      color: #16a34a;
    }

    /* Pomodoro */
    .pomodoro-section .card-body {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .pomodoro-timer {
      font-size: 2.2rem;
      font-weight: 600;
      text-align: center;
      letter-spacing: 0.08em;
      padding: 8px 0;
      border-radius: 10px;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #1e293b;
    }

    .pomodoro-controls {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: 999px;
      padding: 6px 14px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      color: var(--text);
      font-size: 0.8rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.12s ease, transform 0.05s ease, box-shadow 0.12s, border 0.12s;
    }

    .btn:hover {
      background: #eff6ff;
      border-color: #bfdbfe;
      box-shadow: 0 2px 6px rgba(15,23,42,0.08);
      transform: translateY(-1px);
    }

    .btn-primary {
      border-color: var(--accent-soft);
      background: var(--accent);
      color: #ffffff;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn-danger {
      border-color: #fecaca;
      background: #fee2e2;
      color: #b91c1c;
    }

    .btn-danger:hover {
      background: #fecaca;
      border-color: #fca5a5;
    }

    .btn-small {
      font-size: 0.75rem;
      padding: 4px 10px;
    }

    .pomodoro-progress {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .pomodoro-dots {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .pomodoro-dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
    }

    .pomodoro-dot.done {
      background: #3b82f6;
      border-color: #2563eb;
    }

    .pomodoro-info {
      font-size: 0.75rem;
      color: var(--text-soft);
      line-height: 1.4;
    }

    .pomodoro-info strong {
      color: var(--text);
    }

    /* Notes & walkthrough */
    .notes-section .card-body,
    .walkthrough-section .card-body {
      display: flex;
      flex-direction: column;
      gap: 10px;
      font-size: 0.85rem;
    }

    .notes-group {
      border-radius: 10px;
      padding: 8px 10px;
      background: #f9fafb;
      border: 1px solid var(--border-soft);
    }

    .notes-group-title {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 6px;
    }

    .notes-group-title h3 {
      margin: 0;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text);
    }

    .notes-group-title span {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    /* Anteprima materiale */
    .material-preview-wrapper {
      margin-bottom: 10px;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid var(--border-soft);
      background: #e5f0ff;
    }

    .material-iframe-container {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9, come il videoplayer */
      background: #0b1120;
    }

    .material-iframe-container iframe {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: 0;
    }

    .material-hint {
      font-size: 0.8rem;
      color: var(--text-soft);
      padding: 6px 10px;
      background: #eff6ff;
      border-top: 1px solid var(--border-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .material-hint strong {
      color: var(--text);
    }

    .material-info {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    /* Griglia materiale */
    .resources-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 8px;
      margin-top: 4px;
    }

    .resource-card {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      padding: 8px;
      border-radius: 10px;
      background: #ffffff;
      border: 1px solid var(--border-soft);
      transition: border 0.12s ease, box-shadow 0.12s ease, transform 0.05s ease, background 0.12s ease;
      cursor: pointer;
    }

    .resource-card:hover {
      border-color: #bfdbfe;
      box-shadow: 0 2px 6px rgba(15,23,42,0.08);
      background: #f9fafb;
      transform: translateY(-1px);
    }

    .resource-icon {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: 600;
      color: #ffffff;
      flex-shrink: 0;
    }

    .ext-pdf {
      background: #2563eb;
    }
    .ext-docx {
      background: #0ea5e9;
    }
    .ext-ppt {
      background: #f97316;
    }
    .ext-img {
      background: #22c55e;
    }
    .ext-svg {
      background: #a855f7;
    }
    .ext-zip {
      background: #6b7280;
    }

    .resource-content {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .resource-header {
      display: flex;
      align-items: center;
      gap: 6px;
      justify-content: space-between;
      min-width: 0;
    }

    .resource-title {
      font-size: 0.85rem;
      font-weight: 500;
      color: #1d4ed8;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .resource-open {
      font-size: 0.8rem;
      color: #6b7280;
      text-decoration: none;
      flex-shrink: 0;
    }

    .resource-open:hover {
      color: #1e40af;
      text-decoration: underline;
    }

    .resource-meta {
      font-size: 0.75rem;
      color: var(--text-soft);
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }

    .resource-pill {
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      font-size: 0.7rem;
      background: #f9fafb;
    }

    .resource-date {
      font-size: 0.74rem;
    }

    /* Walkthrough */
    .walkthrough-section ol {
      margin: 4px 0 0;
      padding-left: 18px;
    }

    .walkthrough-section li {
      margin-bottom: 6px;
    }

    .walkthrough-section ul {
      margin: 2px 0 6px;
      padding-left: 16px;
    }

    .walkthrough-section li strong {
      color: var(--text);
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Probabilit√† e scienza dei dati ¬∑ Giacomo Dimarco</h1>
    </div>
    <div class="tag">Modalit√† deep work</div>
  </header>

  <main>
    <!-- SEZIONE VIDEO (in alto, a tutta larghezza) -->
    <section class="card video-section">
      <div class="card-header">
        <div>
          <h2>Lezioni &amp; Tutorati</h2>
          <span>Player stile YouTube ¬∑ ordine cronologico ¬∑ tutorati in blu</span>
        </div>
      </div>
      <div class="card-body">
        <div class="video-player-wrapper">
          <div class="video-iframe-container">
            <iframe
              id="videoPlayer"
              src=""
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
            ></iframe>
          </div>
          <div class="video-hint">
            <strong>Nota:</strong> i video sono su Google Drive. Devi essere loggato con l'account abilitato per poterli
            riprodurre. Usa il tasto del player per il <strong>full screen</strong>.
          </div>
        </div>

        <!-- Slider a frecce + Segna come visto -->
        <div class="video-controls-row">
          <div class="video-nav">
            <button id="prevVideoBtn" class="nav-btn" aria-label="Video precedente">‚óÄ</button>
            <span id="videoPosition">1 / 66</span>
            <button id="nextVideoBtn" class="nav-btn" aria-label="Video successivo">‚ñ∂</button>
          </div>
          <button id="markSeenBtn" class="btn btn-small">
            ‚úì Segna come visto
          </button>
        </div>

        <div class="playlist" id="playlist"></div>
      </div>
    </section>

    <!-- POMODORO -->
    <section class="card pomodoro-section">
      <div class="card-header">
        <div>
          <h2>Timer Pomodoro</h2>
          <span>25 minuti ¬∑ 8 pomodori ¬∑ reset automatico alle 06:00 (GMT+1)</span>
        </div>
      </div>
      <div class="card-body">
        <div id="pomodoro-timer" class="pomodoro-timer">25:00</div>

        <div class="pomodoro-controls">
          <button id="startPauseBtn" class="btn btn-primary">
            ‚ñ∂ Avvia
          </button>
          <button id="resetPomodoroBtn" class="btn btn-small">
            ‚Ü∫ Reset pomodoro
          </button>
          <button id="resetDayBtn" class="btn btn-small btn-danger">
            ‚úï Reset giornata
          </button>
        </div>

        <div class="pomodoro-progress">
          <div id="pomodoro-count">0 / 8 pomodori</div>
          <div id="pomodoro-dots" class="pomodoro-dots"></div>
        </div>

        <div class="pomodoro-info">
          Ogni <strong>pomodoro</strong> sono 25 minuti di concentrazione totale (niente telefono, niente notifiche).
          Dopo ogni pomodoro fai una <strong>pausa breve di 5 minuti</strong>; dopo 4 pomodori consecutivi, pausa pi√π lunga
          di 15‚Äì20 minuti.
        </div>
      </div>
    </section>

    <!-- NOTE + ANTEPRIMA -->
        <!-- NOTE + ANTEPRIMA -->
    <section class="card notes-section">
      <div class="card-header">
        <div>
          <h2>Materiale del corso</h2>
          <span>Anteprima stile player + note raggruppate</span>
        </div>
      </div>
      <div class="card-body">
        <!-- ANTEPRIMA MATERIALE -->
        <div class="material-preview-wrapper">
          <div class="material-iframe-container">
            <iframe
              id="materialPreview"
              src=""
              allow="fullscreen"
            ></iframe>
          </div>
          <div class="material-hint">
            <span><strong>Anteprima materiale</strong> ¬∑ clicca una card nella griglia per vedere il file qui sopra.</span>
            <span class="material-info" id="materialInfo">Nessun file selezionato.</span>
          </div>
        </div>

        <!-- Introduzione -->
        <div class="notes-group">
          <div class="notes-group-title">
            <h3>1. Introduzione corso</h3>
            <span>PDF su Google Classroom</span>
          </div>
          <div class="resources-grid">
            <div
              class="resource-card"
              data-url="https://classroom.google.com/u/3/c/Mjc3MTUzMjAxODY3/m/MjkzMTE3NzA1ODky/details"
              data-title="Introduzione corso (PDF)"
              data-date="N/D"
              data-type="Introduzione"
              data-no-preview="true"
            >
              <div class="resource-icon ext-pdf">PDF</div>
              <div class="resource-content">
                <div class="resource-header">
                  <div class="resource-title">Introduzione corso (PDF)</div>
                  <a
                    class="resource-open"
                    href="https://classroom.google.com/u/3/c/Mjc3MTUzMjAxODY3/m/MjkzMTE3NzA1ODky/details"
                    target="_blank"
                    title="Apri in Google Classroom"
                  >‚Üó</a>
                </div>
                <div class="resource-meta">
                  <span class="resource-pill">Introduzione</span>
                  <span class="resource-date">N/D</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Extra -->
        <div class="notes-group">
          <div class="notes-group-title">
            <h3>2. Focus Group</h3>
            <span>Registrazione su Google Drive</span>
          </div>
          <div class="resources-grid">
            <div
              class="resource-card"
              data-url="https://drive.google.com/file/d/1ALiRZQhVfrx3x9ImNpSwSyzwlZ_1Ojsg/view"
              data-title="Focus Group (video)"
              data-date="N/D"
              data-type="Extra"
            >
              <div class="resource-icon ext-ppt">VID</div>
              <div class="resource-content">
                <div class="resource-header">
                  <div class="resource-title">Focus Group (video)</div>
                  <a
                    class="resource-open"
                    href="https://drive.google.com/file/d/1ALiRZQhVfrx3x9ImNpSwSyzwlZ_1Ojsg/view"
                    target="_blank"
                    title="Apri in Google Drive"
                  >‚Üó</a>
                </div>
                <div class="resource-meta">
                  <span class="resource-pill">Extra</span>
                  <span class="resource-date">N/D</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Note -->
        <div class="notes-group">
          <div class="notes-group-title">
            <h3>3. Note</h3>
            <span>Domande/risposte riportate dal corso</span>
          </div>

          <div style="display:flex; flex-direction:column; gap:10px; font-size:0.85rem; color: var(--text); line-height:1.45;">
            <div style="padding:10px; border-radius:10px; border:1px solid var(--border-soft); background:#ffffff;">
              <div style="font-weight:600; margin-bottom:6px;">Note lezione 9</div>

              <div><strong>ALESSANDRO VEDOVOTTO</strong> ¬∑ 6 apr 2021</div>
              <div style="color:var(--text-soft); margin-bottom:8px;">
                Scusi prof nella lezione 9 parte 2, verso il minuto 30:30, quando generalizza la definizione di indipendenza e scrive
                &quot;per ogni sottoinsieme del tipo Ei1 Ei2....Eik&quot; questi eventi sono legati da una moltiplicazione?
                Perch√© tra il primo e il secondo c'√® una moltiplicazione mentre tra il secondo ed Eik no.
              </div>

              <div><strong>Giacomo DIMARCO</strong> ¬∑ 6 apr 2021</div>
              <div style="color:var(--text-soft); margin-bottom:8px;">Gli eventi Ei1, Ei2 ecc. sono <strong>congiunti</strong>, ovvero si verificano tutti.</div>

              <div><strong>ALESSANDRO VEDOVOTTO</strong> ¬∑ 6 apr 2021</div>
              <div style="color:var(--text-soft); margin-bottom:8px;">
                Con congiunti intendiamo che sono tutti collegati tra loro?
                Ad esempio Ei1{1,2,3} Ei2{3,4,5} Ei3{5,6,7} sono considerati congiunti oppure lo possono essere Ei1{1,2,3} Ei2{3,4,5} Ei3{3,6,7}?
              </div>

              <div><strong>Giacomo DIMARCO</strong> ¬∑ 6 apr 2021</div>
              <div style="color:var(--text-soft); margin-bottom:8px;">
                Con congiunti si intende che si verifica sia E·µ¢‚ÇÅ che E·µ¢‚ÇÇ che ... che E.
                Esempio: E‚ÇÅ = &quot;pesco un asso&quot;, E‚ÇÇ = &quot;pesco una carta di cuori&quot;.
                L'evento congiunto √® &quot;pesco l'asso di cuori&quot; perch√© si verificano sia E‚ÇÅ che E‚ÇÇ.
              </div>

              <div><strong>ALESSANDRO VEDOVOTTO</strong> ¬∑ 8 apr 2021</div>
              <div style="color:var(--text-soft); margin-bottom:8px;">Grazie mille del chiarimento</div>

              <div><strong>LUCA RAMAZZINA</strong> ¬∑ 9 apr 2021</div>
              <div style="color:var(--text-soft); margin-bottom:8px;">
                Prof nella lezione 9 parte 1 esercizio 6, 0,05 √® 5¬∑10^-2 non 10^-4
              </div>

              <div><strong>Giacomo DIMARCO</strong> ¬∑ 12 apr 2021</div>
              <div style="color:var(--text-soft);">Direi che √® 10^-4.</div>
            </div>

            <div style="padding:10px; border-radius:10px; border:1px solid var(--border-soft); background:#ffffff;">
              <div style="font-weight:600; margin-bottom:6px;">Note lezione 16</div>

              <div><strong>LUCA RAMAZZINA</strong> ¬∑ 2 mag 2021</div>
              <div style="color:var(--text-soft); margin-bottom:8px;">
                Prof nella prima parte al minuto 15, la funzione di distribuzione non dovrebbe assumere valore 1 con a ‚â• Œ≤?
              </div>

              <div><strong>Giacomo DIMARCO</strong> ¬∑ 3 mag 2021</div>
              <div style="color:var(--text-soft);">
                S√¨ certo. Vado a correggere. Grazie per la segnalazione.
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="card walkthrough-section">
      <div class="card-header">
        <div>
          <h2>Walkthrough per massimizzare il rendimento</h2>
          <span>Routine consigliata di studio</span>
        </div>
      </div>
      <div class="card-body">
        <ol>
          <li>
            <strong>Prima di iniziare un blocco di studio (5 minuti)</strong>
            <ul>
              <li>Apri il <strong>timer pomodoro</strong> e imposta un obiettivo: ad esempio 2 pomodori per una lezione.</li>
              <li>Guarda la <strong>Roadmap Elettricit√† e Magnetismo</strong> per sapere dove si colloca la lezione.</li>
              <li>Riapri velocemente le <strong>note dell'ultima lezione</strong> per agganciare il contesto.</li>
            </ul>
          </li>
          <li>
            <strong>Durante la lezione video (1‚Äì2 pomodori)</strong>
            <ul>
              <li>Fai partire il <strong>pomodoro da 25 minuti</strong> e guarda la lezione senza mettere pausa ogni 2 secondi.</li>
              <li>Annota solo le idee chiave e i passaggi che non sono chiari (niente appunti lunghissimi).</li>
              <li>Alla fine del pomodoro, fai <strong>pausa 5 minuti</strong>, poi continua se necessario.</li>
            </ul>
          </li>
          <li>
            <strong>Dopo la lezione (1 pomodoro)</strong>
            <ul>
              <li>Apri le <strong>dispense / Lezione_X.pdf o .docx</strong> corrispondenti e completa gli appunti a mente fredda.</li>
              <li>Collega formule e concetti ai <strong>formulario EM / OO</strong> (anche se ancora in anticipo).</li>
            </ul>
          </li>
          <li>
            <strong>Sessione di esercizi con tutorato (1‚Äì2 pomodori)</strong>
            <ul>
              <li>Guarda il <strong>tutorato corrispondente</strong> (in blu nella playlist) dopo aver visto la lezione relativa.</li>
              <li>Metti in pausa solo quando provi tu a <strong>risolvere l'esercizio</strong> prima della soluzione.</li>
              <li>Segna gli esercizi simili da rivedere negli <strong>esami passati</strong>.</li>
            </ul>
          </li>
          <li>
            <strong>Ripasso settimanale (2‚Äì3 pomodori a settimana)</strong>
            <ul>
              <li>Scegli 1‚Äì2 lezioni della settimana e rileggi solo le <strong>note sintetiche</strong> e le formule critiche.</li>
              <li>Risolvi 2‚Äì3 esercizi dagli <strong>esami passati</strong> usando solo il formulario.</li>
            </ul>
          </li>
          <li>
            <strong>Preparazione all'esame</strong>
            <ul>
              <li>Usa i <strong>formulario EM / OO</strong> come check-list: ogni formula deve essere ‚Äúovvia‚Äù per te.</li>
              <li>Simula almeno 2‚Äì3 esami completi in tempo reale (usa il timer, niente consulti esterni).</li>
              <li>Se un argomento ricompare spesso negli esami, torna alla sua <strong>lezione + tutorato</strong> specifici.</li>
            </ul>
          </li>
          <li>
            <strong>Gestione energia e concentrazione</strong>
            <ul>
              <li>Cerca di non superare i <strong>6‚Äì8 pomodori intensi</strong> al giorno per lo studio: meglio costanza che maratone.</li>
              <li>Segna mentalmente quali orari ti rendono pi√π produttivo e prova a fissare l√¨ i blocchi pi√π difficili.</li>
            </ul>
          </li>
        </ol>
      </div>
    </section>
  </main>

  <script>
    // --- DATI LEZIONI & TUTORATI (ordine cronologico) ---
        const videos = [
      {
        id: 1,
        title: "Lezione 1 ¬∑ Video 1",
        dateLabel: "Lezione 1",
        url: "https://drive.google.com/file/d/1dyr_aMVbbrmrpsCysfXMh3P8X-WWOLWu/view",
        type: "lesson"
      },
      {
        id: 2,
        title: "Lezione 1 ¬∑ Video 2",
        dateLabel: "Lezione 1",
        url: "https://drive.google.com/file/d/1VqVB--Eo5kkqmP0FowaZlkDsW20wAbCC/view",
        type: "lesson"
      },
      {
        id: 3,
        title: "Lezione 1 ¬∑ Video 3",
        dateLabel: "Lezione 1",
        url: "https://drive.google.com/file/d/1r-ZAOQec47nghrl7QIOhIGFBYOUlqNzv/view",
        type: "lesson"
      },
      {
        id: 4,
        title: "Lezione 2 ¬∑ Video 1",
        dateLabel: "Lezione 2",
        url: "https://drive.google.com/file/d/1RfoIFY2ayHC-FVk305_LWNt2d3NHfvxX/view",
        type: "lesson"
      },
      {
        id: 5,
        title: "Lezione 2 ¬∑ Video 2",
        dateLabel: "Lezione 2",
        url: "https://drive.google.com/file/d/171reSRnu2fikghVXLlR3mfSWmUD3DI9T/view",
        type: "lesson"
      },
      {
        id: 6,
        title: "Lezione 2 ¬∑ Video 3",
        dateLabel: "Lezione 2",
        url: "https://drive.google.com/file/d/1c4HXO_HA9461MA1nVIwKszNRNiyQ5s7y/view",
        type: "lesson"
      },
      {
        id: 7,
        title: "Lezione 3 ¬∑ Video 1",
        dateLabel: "Lezione 3",
        url: "https://drive.google.com/file/d/1U8OPa1d-A6VSXl2TRo8JMemMzs_PEQ6S/view",
        type: "lesson"
      },
      {
        id: 8,
        title: "Lezione 3 ¬∑ Video 2",
        dateLabel: "Lezione 3",
        url: "https://drive.google.com/file/d/1xUcUDquijsjrSiUHevxZ5FNrHNdWKP4Z/view",
        type: "lesson"
      },
      {
        id: 9,
        title: "Lezione 3 ¬∑ Video 3",
        dateLabel: "Lezione 3",
        url: "https://drive.google.com/file/d/1wZ0PWn3n4eTDb3RvaJ4gmXe0G3jztlK8/view",
        type: "lesson"
      },
      {
        id: 10,
        title: "Lezione 4 ¬∑ Video 1",
        dateLabel: "Lezione 4",
        url: "https://drive.google.com/file/d/1x6sVVjhLIkiwY4UEGOrBiNteY4pKty_6/view",
        type: "lesson"
      },
      {
        id: 11,
        title: "Lezione 4 ¬∑ Video 2",
        dateLabel: "Lezione 4",
        url: "https://drive.google.com/file/d/1hZGAON4C7v_HlQOo7fae2QKCsqmjoAdZ/view",
        type: "lesson"
      },
      {
        id: 12,
        title: "Lezione 4 ¬∑ Video 3",
        dateLabel: "Lezione 4",
        url: "https://drive.google.com/file/d/1UY5Q-RPgB8OKSCU6tIZhA96vK24SLeDZ/view",
        type: "lesson"
      },
      {
        id: 13,
        title: "Lezione 5 ¬∑ Video 1",
        dateLabel: "Lezione 5",
        url: "https://drive.google.com/file/d/1fbOfck3S_wXltHK1JSTIfWSbMoMn7eQJ/view",
        type: "lesson"
      },
      {
        id: 14,
        title: "Lezione 5 ¬∑ Video 2",
        dateLabel: "Lezione 5",
        url: "https://drive.google.com/file/d/1j2d605JsqXAtqsGs8DuSg9jtVnLqhypO/view",
        type: "lesson"
      },
      {
        id: 15,
        title: "Lezione 5 ¬∑ Video 3",
        dateLabel: "Lezione 5",
        url: "https://drive.google.com/file/d/18uvXuitBOdJJzPcSWxUjrvJWIEe18mTS/view",
        type: "lesson"
      },
      {
        id: 16,
        title: "Lezione 6 ¬∑ Video 1",
        dateLabel: "Lezione 6",
        url: "https://drive.google.com/file/d/11mDfcJ5H-i6ACcM6GvrYslfy5yzfKyB2/view",
        type: "lesson"
      },
      {
        id: 17,
        title: "Lezione 6 ¬∑ Video 2",
        dateLabel: "Lezione 6",
        url: "https://drive.google.com/file/d/1csFopB176R41sZX9wZB8MkidGYj10h1T/view",
        type: "lesson"
      },
      {
        id: 18,
        title: "Lezione 7 ¬∑ Video 1",
        dateLabel: "Lezione 7",
        url: "https://drive.google.com/file/d/1vdIf6WtCNuICj0xXdVr_zsSN-c5ahtVx/view",
        type: "lesson"
      },
      {
        id: 19,
        title: "Lezione 7 ¬∑ Video 2",
        dateLabel: "Lezione 7",
        url: "https://drive.google.com/file/d/1U_UsCzgwZ4c9rtbo8adidthIhCxRG_F8/view",
        type: "lesson"
      },
      {
        id: 20,
        title: "Lezione 8 ¬∑ Video 1",
        dateLabel: "Lezione 8",
        url: "https://drive.google.com/file/d/1iLbEmM3cbEy5SnnKSsv1ZMTntrD458Lv/view",
        type: "lesson"
      },
      {
        id: 21,
        title: "Lezione 8 ¬∑ Video 2",
        dateLabel: "Lezione 8",
        url: "https://drive.google.com/file/d/1GfE6K548IytToKxLsldDZJ3LRRJzWSgU/view",
        type: "lesson"
      },
      {
        id: 22,
        title: "Lezione 8 ¬∑ Video 3",
        dateLabel: "Lezione 8",
        url: "https://drive.google.com/file/d/1TlWz4jhTfawz4O6U-BWn8dyFenzoT85M/view",
        type: "lesson"
      },
      {
        id: 23,
        title: "Lezione 9 ¬∑ Video 1",
        dateLabel: "Lezione 9",
        url: "https://drive.google.com/file/d/1Lv7Cc1EZ6rDYKnYExV3G_C2oJW2jvgf4/view",
        type: "lesson"
      },
      {
        id: 24,
        title: "Lezione 9 ¬∑ Video 2",
        dateLabel: "Lezione 9",
        url: "https://drive.google.com/file/d/14Zw4_mo5lTJIwkdjSpnVXXt8bsIwIyv8/view",
        type: "lesson"
      },
      {
        id: 25,
        title: "Lezione 10 ¬∑ Video 1",
        dateLabel: "Lezione 10",
        url: "https://drive.google.com/file/d/1LaWSTV36YxZ-DK8e8uq1pHHxH1TKEueU/view",
        type: "lesson"
      },
      {
        id: 26,
        title: "Lezione 10 ¬∑ Video 2",
        dateLabel: "Lezione 10",
        url: "https://drive.google.com/file/d/1WdlSuLrCNc1LhBsfklXhT0yNUmglx2Im/view",
        type: "lesson"
      },
      {
        id: 27,
        title: "Lezione 10 ¬∑ Video 3",
        dateLabel: "Lezione 10",
        url: "https://drive.google.com/file/d/1s2nFFWhFkgsc9uDo0Ld6pJDtKGAuDXma/view",
        type: "lesson"
      },
      {
        id: 28,
        title: "Lezione 11 ¬∑ Video 1",
        dateLabel: "Lezione 11",
        url: "https://drive.google.com/file/d/15C0aT-3mC289u0d9hVLOdR9SbyOZSoNI/view",
        type: "lesson"
      },
      {
        id: 29,
        title: "Lezione 11 ¬∑ Video 2",
        dateLabel: "Lezione 11",
        url: "https://drive.google.com/file/d/1GJTzIn-QFtl2lZM_AYq5G_W8ladd6gMR/view",
        type: "lesson"
      },
      {
        id: 30,
        title: "Lezione 11 ¬∑ Video 3",
        dateLabel: "Lezione 11",
        url: "https://drive.google.com/file/d/15zJttYzSzePQt98jTRc9iylki7whUl7N/view",
        type: "lesson"
      },
      {
        id: 31,
        title: "Lezione 12 ¬∑ Video 1",
        dateLabel: "Lezione 12",
        url: "https://drive.google.com/file/d/1a8xFMWsuwuTNVCiPZwd06bhBRIoaDBAE/view",
        type: "lesson"
      },
      {
        id: 32,
        title: "Lezione 12 ¬∑ Video 2",
        dateLabel: "Lezione 12",
        url: "https://drive.google.com/file/d/1Hm104Y0vwjlcQGBcU2BzS5SCHH6O7kDR/view",
        type: "lesson"
      },
      {
        id: 33,
        title: "Lezione 12 ¬∑ Video 3",
        dateLabel: "Lezione 12",
        url: "https://drive.google.com/file/d/1vCzc0HmkICSAR0JicAJGm3hymUez7rrK/view",
        type: "lesson"
      },
      {
        id: 34,
        title: "Lezione 13 ¬∑ Video 1",
        dateLabel: "Lezione 13",
        url: "https://drive.google.com/file/d/1vS-dOkrJIvd_xAxkSTy_99jxFXrs4ZNk/view",
        type: "lesson"
      },
      {
        id: 35,
        title: "Lezione 13 ¬∑ Video 2",
        dateLabel: "Lezione 13",
        url: "https://drive.google.com/file/d/13sr4hA9JkaCKyct7wdv5qpWZ17kNrRav/view",
        type: "lesson"
      },
      {
        id: 36,
        title: "Lezione 13 ¬∑ Video 3",
        dateLabel: "Lezione 13",
        url: "https://drive.google.com/file/d/1oh3U7qfoC-0Hb_tQqmxYWX1_Xxl2hMYs/view",
        type: "lesson"
      },
      {
        id: 37,
        title: "Lezione 14 ¬∑ Video 1",
        dateLabel: "Lezione 14",
        url: "https://drive.google.com/file/d/1oh3U7qfoC-0Hb_tQqmxYWX1_Xxl2hMYs/view",
        type: "lesson"
      },
      {
        id: 38,
        title: "Lezione 14 ¬∑ Video 2",
        dateLabel: "Lezione 14",
        url: "https://drive.google.com/file/d/1MZZswncexorvpFObchapoTPKtptj_u16/view",
        type: "lesson"
      },
      {
        id: 39,
        title: "Lezione 15 ¬∑ Video 1",
        dateLabel: "Lezione 15",
        url: "https://drive.google.com/file/d/1wJPm0bE6S2alZVXFcVqqovsZRqowNrgt/view",
        type: "lesson"
      },
      {
        id: 40,
        title: "Lezione 15 ¬∑ Video 2",
        dateLabel: "Lezione 15",
        url: "https://drive.google.com/file/d/1HxWzj46Og1MIbZ9GvFuILr43U8FJePo5/view",
        type: "lesson"
      },
      {
        id: 41,
        title: "Lezione 15 ¬∑ Video 3",
        dateLabel: "Lezione 15",
        url: "https://drive.google.com/file/d/1LNh3SU4nuA3b60ycajhrL8jH0SnKpoNW/view",
        type: "lesson"
      },
      {
        id: 42,
        title: "Lezione 16 ¬∑ Video 1",
        dateLabel: "Lezione 16",
        url: "https://drive.google.com/file/d/1l0Az4RyAP_BBsnpUyT0YZWMMJ-ZWSe5_/view",
        type: "lesson"
      },
      {
        id: 43,
        title: "Lezione 16 ¬∑ Video 2",
        dateLabel: "Lezione 16",
        url: "https://drive.google.com/file/d/1VXkfonyKwVk0rfLeAaGDSsTPhR0Th9zf/view",
        type: "lesson"
      },
      {
        id: 44,
        title: "Lezione 16 ¬∑ Video 3",
        dateLabel: "Lezione 16",
        url: "https://drive.google.com/file/d/1FELL6teYJR5YbUBjNqHhoPIuRJTw6O8s/view",
        type: "lesson"
      },
      {
        id: 45,
        title: "Lezione 17 ¬∑ Video 1",
        dateLabel: "Lezione 17",
        url: "https://drive.google.com/file/d/1m-BYk4OnwAvhT_s8XfgBP7pC05n_ajJK/view",
        type: "lesson"
      },
      {
        id: 46,
        title: "Lezione 17 ¬∑ Video 2",
        dateLabel: "Lezione 17",
        url: "https://drive.google.com/file/d/1UcUyR2tqo78gwYxMUkNpKdPpqZ1NFwN3/view",
        type: "lesson"
      },
      {
        id: 47,
        title: "Lezione 18 ¬∑ Video 1",
        dateLabel: "Lezione 18",
        url: "https://drive.google.com/file/d/1BK-eEsHT4fAufCjmlL0brjr8F59WBCKk/view",
        type: "lesson"
      },
      {
        id: 48,
        title: "Lezione 18 ¬∑ Video 2",
        dateLabel: "Lezione 18",
        url: "https://drive.google.com/file/d/1ZwXi4raFceks6t7U3Dzi09JlvSzthwzh/view",
        type: "lesson"
      },
      {
        id: 49,
        title: "Lezione 18 ¬∑ Video 3",
        dateLabel: "Lezione 18",
        url: "https://drive.google.com/file/d/18mhyLKB1dAY8y4OeiRdQyhygMhgq386R/view",
        type: "lesson"
      },
      {
        id: 50,
        title: "Lezione 19 ¬∑ Video 1",
        dateLabel: "Lezione 19",
        url: "https://drive.google.com/file/d/1F5982H7p2AuRqUXSDfCPSilXCmc4-_io/view",
        type: "lesson"
      },
      {
        id: 51,
        title: "Lezione 19 ¬∑ Video 2",
        dateLabel: "Lezione 19",
        url: "https://drive.google.com/file/d/1_DePQNPdNnzOwtbfaTxFGgRZFTPiLcgP/view",
        type: "lesson"
      },
      {
        id: 52,
        title: "Lezione 19 ¬∑ Video 3",
        dateLabel: "Lezione 19",
        url: "https://drive.google.com/file/d/1ziuWo4NbLSum8iZnMO7nlZ7ZbDVn_nwn/view",
        type: "lesson"
      },
      {
        id: 53,
        title: "Lezione 20 ¬∑ Video 1",
        dateLabel: "Lezione 20",
        url: "https://drive.google.com/file/d/1aGorE-skeDPanPasDf-_quVzfWlOzbd-/view",
        type: "lesson"
      },
      {
        id: 54,
        title: "Lezione 20 ¬∑ Video 2",
        dateLabel: "Lezione 20",
        url: "https://drive.google.com/file/d/19j6V_6ZAvJ-L_A9WHH_oMLj6HVaygPGp/view",
        type: "lesson"
      },
      {
        id: 55,
        title: "Lezione 20 ¬∑ Video 3",
        dateLabel: "Lezione 20",
        url: "https://drive.google.com/file/d/10B6Wal9yjrMWcTLtvRZ-nhnxzP8WpVcT/view",
        type: "lesson"
      },
      {
        id: 56,
        title: "Lezione 21 ¬∑ Video 1",
        dateLabel: "Lezione 21",
        url: "https://drive.google.com/file/d/1MH9P2eOoZx-ZNRC7kXn8smY0UnW6Qam_/view",
        type: "lesson"
      },
      {
        id: 57,
        title: "Lezione 21 ¬∑ Video 2",
        dateLabel: "Lezione 21",
        url: "https://drive.google.com/file/d/18Lw9VTO1HjWd9NlroJFju6UJvQoI3qAA/view",
        type: "lesson"
      },
      {
        id: 58,
        title: "Lezione 22 ¬∑ Video 1",
        dateLabel: "Lezione 22",
        url: "https://drive.google.com/file/d/1g2sfzCen4S1504GaZrF5TqN1nuiWQCL2/view",
        type: "lesson"
      },
      {
        id: 59,
        title: "Lezione 22 ¬∑ Video 2",
        dateLabel: "Lezione 22",
        url: "https://drive.google.com/file/d/1W5Pp0rGCqOw1_O2vvvYgNfO9jdjYNOsI/view",
        type: "lesson"
      },
      {
        id: 60,
        title: "Lezione 22 ¬∑ Video 3",
        dateLabel: "Lezione 22",
        url: "https://drive.google.com/file/d/1LuFLzFppQLZyk_K4SAMVXp9u8gRtyEOO/view",
        type: "lesson"
      },
      {
        id: 61,
        title: "Lezione 23 ¬∑ Video 1",
        dateLabel: "Lezione 23",
        url: "https://drive.google.com/file/d/1hm4-4ZDKWPx8CCjnGdV4FGBr1Hnabk2a/view",
        type: "lesson"
      },
      {
        id: 62,
        title: "Lezione 23 ¬∑ Video 2",
        dateLabel: "Lezione 23",
        url: "https://drive.google.com/file/d/1si_r-YPB4H8txo6ex0yIWEiP8wq9E_hj/view",
        type: "lesson"
      },
      {
        id: 63,
        title: "Lezione 23 ¬∑ Video 3",
        dateLabel: "Lezione 23",
        url: "https://drive.google.com/file/d/1E02F7fGjqI-ggJ9szlynZfrDa1Uhnz9W/view",
        type: "lesson"
      },
      {
        id: 64,
        title: "Lezione 24 ¬∑ Video 1",
        dateLabel: "Lezione 24",
        url: "https://drive.google.com/file/d/1FyXhvv7yGG30pcbaM2z4vv8O4PgoFkdD/view",
        type: "lesson"
      },
      {
        id: 65,
        title: "Lezione 24 ¬∑ Video 2",
        dateLabel: "Lezione 24",
        url: "https://drive.google.com/file/d/1rrrARtS3UvaMk1uUvehhSbptvtL2Jvdo/view",
        type: "lesson"
      },
      {
        id: 66,
        title: "Focus Group",
        dateLabel: "Extra",
        url: "https://drive.google.com/file/d/1ALiRZQhVfrx3x9ImNpSwSyzwlZ_1Ojsg/view",
        type: "extra"
      }
    ];

    let currentVideoIndex = 0;
    let seenVideoIds = new Set();

    function transformDriveUrl(url) {
      return url.replace("/view", "/preview");
    }

    function loadSeenVideos() {
      try {
        const raw = localStorage.getItem("probabilita_seenVideos");
        if (!raw) {
          seenVideoIds = new Set();
          return;
        }
        const arr = JSON.parse(raw);
        if (Array.isArray(arr)) {
          seenVideoIds = new Set(arr);
        } else {
          seenVideoIds = new Set();
        }
      } catch (e) {
        seenVideoIds = new Set();
      }
    }

    function saveSeenVideos() {
      const arr = Array.from(seenVideoIds);
      localStorage.setItem("probabilita_seenVideos", JSON.stringify(arr));
    }

    function renderPlaylist() {
      const playlistEl = document.getElementById("playlist");
      playlistEl.innerHTML = "";

      videos.forEach((video, index) => {
        const btn = document.createElement("button");
        let extraClass = "";
        if (video.type === "tutorato") extraClass += " tutorato";
        if (seenVideoIds.has(video.id)) extraClass += " seen";

        btn.className = "playlist-item" + extraClass;
        btn.dataset.index = index.toString();

        let badgeClass = "badge-lesson";
        let badgeLabel = "Lezione";
        if (video.type === "tutorato") {
          badgeClass = "badge-tutorato";
          badgeLabel = "Tutorato";
        } else if (video.type === "extra") {
          badgeClass = "badge-extra";
          badgeLabel = "Recupero";
        }

        const seenLabel = seenVideoIds.has(video.id)
          ? '<span class="seen-flag">‚úì visto</span>'
          : "";

        btn.innerHTML = `
          <div class="playlist-thumbnail">
            <div class="play-icon">‚ñ∂</div>
          </div>
          <div class="playlist-meta">
            <div class="playlist-title">${video.title}</div>
            <div class="playlist-subtitle">
              <span>${video.dateLabel}</span>
              <span class="badge ${badgeClass}">${badgeLabel}</span>
              ${seenLabel}
            </div>
          </div>
        `;

        btn.addEventListener("click", () => {
          setActiveVideo(index);
        });

        playlistEl.appendChild(btn);
      });
    }

    function updateVideoPositionLabel() {
      const positionEl = document.getElementById("videoPosition");
      if (positionEl) {
        positionEl.textContent = `${currentVideoIndex + 1} / ${videos.length}`;
      }
    }

    function setActiveVideo(index) {
      if (index < 0 || index >= videos.length) return;
      currentVideoIndex = index;

      const video = videos[index];
      const iframe = document.getElementById("videoPlayer");
      iframe.src = transformDriveUrl(video.url);

      document.querySelectorAll(".playlist-item").forEach((el) => {
        el.classList.remove("active");
      });

      const current = document.querySelector(`.playlist-item[data-index="${index}"]`);
      if (current) {
        current.classList.add("active");
        if (current.scrollIntoView) {
          current.scrollIntoView({ block: "nearest", behavior: "smooth" });
        }
      }

      updateVideoPositionLabel();
    }

    function showPrevVideo() {
      setActiveVideo(currentVideoIndex - 1);
    }

    function showNextVideo() {
      setActiveVideo(currentVideoIndex + 1);
    }

    function markCurrentAsSeen() {
      const video = videos[currentVideoIndex];
      if (!video) return;
      if (!seenVideoIds.has(video.id)) {
        seenVideoIds.add(video.id);
        saveSeenVideos();
        renderPlaylist();
        setActiveVideo(currentVideoIndex); // ri-applica active dopo il re-render
      }
    }

    // --- POMODORO TIMER ---
    const POMODORO_DURATION = 25 * 60; // 25 minuti in secondi
    const MAX_POMODORI = 8;

    let remainingSeconds = POMODORO_DURATION;
    let isRunning = false;
    let completedPomodori = 0;
    let timerInterval = null;

    function getStudyDayId() {
      const now = new Date();
      // Reset alle 06:00 ora locale (GMT+1 tipicamente)
      const current = new Date(now.getTime());
      if (current.getHours() < 6) {
        current.setDate(current.getDate() - 1);
      }
      const y = current.getFullYear();
      const m = String(current.getMonth() + 1).padStart(2, "0");
      const d = String(current.getDate()).padStart(2, "0");
      return `${y}-${m}-${d}`;
    }

    function savePomodoroState() {
      localStorage.setItem("pomodoroDayId", getStudyDayId());
      localStorage.setItem("pomodoroCompleted", String(completedPomodori));
      localStorage.setItem("pomodoroRemaining", String(remainingSeconds));
      localStorage.setItem("pomodoroIsRunning", isRunning ? "true" : "false");
      if (isRunning) {
        localStorage.setItem("pomodoroLastUpdate", String(Date.now()));
      }
    }

    function loadPomodoroState() {
      const currentDayId = getStudyDayId();
      const savedDayId = localStorage.getItem("pomodoroDayId");

      if (!savedDayId || savedDayId !== currentDayId) {
        completedPomodori = 0;
        remainingSeconds = POMODORO_DURATION;
        isRunning = false;
        localStorage.setItem("pomodoroDayId", currentDayId);
        localStorage.setItem("pomodoroCompleted", "0");
        localStorage.setItem("pomodoroRemaining", String(POMODORO_DURATION));
        localStorage.setItem("pomodoroIsRunning", "false");
        localStorage.removeItem("pomodoroLastUpdate");
        updatePomodoroDisplay();
        return;
      }

      completedPomodori = parseInt(localStorage.getItem("pomodoroCompleted") || "0", 10);
      remainingSeconds = parseInt(localStorage.getItem("pomodoroRemaining") || String(POMODORO_DURATION), 10);
      isRunning = localStorage.getItem("pomodoroIsRunning") === "true";
      const lastUpdate = localStorage.getItem("pomodoroLastUpdate");

      if (isRunning && lastUpdate) {
        const now = Date.now();
        const diffSec = Math.floor((now - parseInt(lastUpdate, 10)) / 1000);
        remainingSeconds -= diffSec;
        if (remainingSeconds <= 0) {
          remainingSeconds = POMODORO_DURATION;
          isRunning = false;
          if (completedPomodori < MAX_POMODORI) {
            completedPomodori++;
          }
        }
      }

      updatePomodoroDisplay();

      if (isRunning) {
        startTimerInterval();
      }
    }

    function updatePomodoroDisplay() {
      const timerEl = document.getElementById("pomodoro-timer");
      const countEl = document.getElementById("pomodoro-count");
      const startBtn = document.getElementById("startPauseBtn");

      const minutes = Math.floor(remainingSeconds / 60);
      const seconds = remainingSeconds % 60;
      timerEl.textContent = `${String(minutes).padStart(2, "0")}:${String(seconds).padStart(2, "0")}`;

      countEl.textContent = `${completedPomodori} / ${MAX_POMODORI} pomodori`;
      startBtn.textContent = isRunning ? "‚è∏ Pausa" : "‚ñ∂ Avvia";

      renderPomodoroDots();
    }

    function renderPomodoroDots() {
      const container = document.getElementById("pomodoro-dots");
      container.innerHTML = "";
      for (let i = 0; i < MAX_POMODORI; i++) {
        const dot = document.createElement("span");
        dot.className = "pomodoro-dot" + (i < completedPomodori ? " done" : "");
        container.appendChild(dot);
      }
    }

    function startTimerInterval() {
      if (timerInterval) clearInterval(timerInterval);

      timerInterval = setInterval(() => {
        remainingSeconds--;
        if (remainingSeconds <= 0) {
          if (completedPomodori < MAX_POMODORI) {
            completedPomodori++;
          }
          remainingSeconds = POMODORO_DURATION;
          isRunning = false;
          clearInterval(timerInterval);
          timerInterval = null;
          alert("Pomodoro completato! Fai una pausa üôÇ");
        }
        updatePomodoroDisplay();
        savePomodoroState();
      }, 1000);
    }

    function toggleStartPause() {
      isRunning = !isRunning;
      if (isRunning) {
        startTimerInterval();
      } else {
        if (timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
        }
      }
      updatePomodoroDisplay();
      savePomodoroState();
    }

    function resetCurrentPomodoro() {
      remainingSeconds = POMODORO_DURATION;
      isRunning = false;
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      updatePomodoroDisplay();
      savePomodoroState();
    }

    function resetStudyDay() {
      completedPomodori = 0;
      remainingSeconds = POMODORO_DURATION;
      isRunning = false;
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      localStorage.setItem("pomodoroDayId", getStudyDayId());
      localStorage.setItem("pomodoroCompleted", "0");
      localStorage.setItem("pomodoroRemaining", String(POMODORO_DURATION));
      localStorage.setItem("pomodoroIsRunning", "false");
      localStorage.removeItem("pomodoroLastUpdate");
      updatePomodoroDisplay();
    }

    function initPomodoro() {
      loadPomodoroState();
      document.getElementById("startPauseBtn").addEventListener("click", toggleStartPause);
      document.getElementById("resetPomodoroBtn").addEventListener("click", resetCurrentPomodoro);
      document.getElementById("resetDayBtn").addEventListener("click", resetStudyDay);
    }

    // --- ANTEPRIMA MATERIALE ---
    function initMaterialPreview() {
      const preview = document.getElementById("materialPreview");
      const info = document.getElementById("materialInfo");
      if (!preview || !info) return;

      const cards = document.querySelectorAll(".resource-card");
      cards.forEach((card) => {
        card.addEventListener("click", (event) => {
          // Se clicchi sulla freccia ‚Üó, lascio il link normale
          const openLink = event.target.closest(".resource-open");
          if (openLink) return;

          const url = card.dataset.url;
          if (!url) return;
          const title = card.dataset.title || "";
          const date = card.dataset.date || "";
          const type = card.dataset.type || "";

          // Alcuni link (es. Google Classroom) non sono embeddabili: apro in una nuova scheda
          if (card.dataset.noPreview === "true") {
            window.open(url, "_blank");
            return;
          }

          preview.src = transformDriveUrl(url);
          const pieces = [];
          if (title) pieces.push(title);
          if (date) pieces.push(date);
          if (type) pieces.push(type);
          info.textContent = pieces.join(" ¬∑ ");
        });
      });

      // Carico in automatico il primo materiale (salto quelli senza anteprima)
      const allCards = Array.from(document.querySelectorAll(".resource-card"));
      const firstCard = allCards.find((c) => c.dataset.noPreview !== "true") || allCards[0];
      if (firstCard) {
        firstCard.click();
      }
    }

    // --- INIT ---
    document.addEventListener("DOMContentLoaded", () => {
      loadSeenVideos();
      renderPlaylist();
      if (videos.length > 0) {
        setActiveVideo(0);
      }

      const prevBtn = document.getElementById("prevVideoBtn");
      const nextBtn = document.getElementById("nextVideoBtn");
      const markSeenBtn = document.getElementById("markSeenBtn");
      if (prevBtn) prevBtn.addEventListener("click", showPrevVideo);
      if (nextBtn) nextBtn.addEventListener("click", showNextVideo);
      if (markSeenBtn) markSeenBtn.addEventListener("click", markCurrentAsSeen);

      initPomodoro();
      initMaterialPreview();
    });
  </script>
</body>
</html>